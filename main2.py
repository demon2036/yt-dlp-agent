#!/usr/bin/env python3
"""ç®€æ´çš„ yt-dlp ä¸‹è½½å·¥å…·"""

import os
import argparse


def build_command(urls, audio_only=True, use_proxy=True):
    """
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘ æ„å»º yt-dlp å‘½ä»¤                                           â•‘
    â•‘ â€¢ æ”¯æŒå•ä¸ªæˆ–å¤šä¸ª URL æ‰¹é‡ä¸‹è½½                               â•‘
    â•‘ â€¢ é»˜è®¤å¯ç”¨ä»£ç†å’ŒéŸ³é¢‘æå–                                   â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    """
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # åŸºç¡€å‘½ä»¤ï¼šå¹¶å‘ä¸‹è½½ + è·¯å¾„æ¨¡æ¿ + Cookie è®¤è¯
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    cmd = [
        "yt-dlp",
        "-N 16",
        "-o 'yt_dlp/%(uploader)s-%(playlist).20s/%(playlist_index)02d %(title).60s.%(ext)s'",
        "--cookies-from-browser firefox",
        "--hls-prefer-native",
    ]

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # éŸ³é¢‘/è§†é¢‘æ¨¡å¼
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    if audio_only:
        cmd.extend(["-x", "--audio-format mp3"])
    else:
        cmd.extend(["--write-sub", "--write-auto-sub", "--embed-sub"])

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ä»£ç†é…ç½®
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    if use_proxy:
        cmd.append("--proxy socks5://127.0.0.1:1089/")

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # URL åˆ—è¡¨ï¼ˆæ”¯æŒå•ä¸ªæˆ–å¤šä¸ªï¼Œç»Ÿä¸€å¤„ç†ï¼‰
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    if isinstance(urls, str):
        cmd.append(urls)
    else:
        cmd.extend(urls)

    return " ".join(cmd)


def main():
    """
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘ ä¸»å‡½æ•°ï¼šè§£æå‚æ•°å¹¶æ‰§è¡Œä¸‹è½½                                 â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    """
    parser = argparse.ArgumentParser(
        description='yt-dlp æ‰¹é‡ä¸‹è½½å·¥å…·',
        formatter_class=argparse.RawDescriptionHelpFormatter,
        epilog='''
ç¤ºä¾‹:
  %(prog)s URL1 URL2 URL3                    # ä¸‹è½½å¤šä¸ªè§†é¢‘çš„éŸ³é¢‘
  %(prog)s -v URL1 URL2                      # ä¸‹è½½è§†é¢‘ï¼ˆå«å­—å¹•ï¼‰
  %(prog)s --no-proxy URL                    # ä¸ä½¿ç”¨ä»£ç†
        '''
    )

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # å‚æ•°å®šä¹‰
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    parser.add_argument('urls', nargs='+',
                        help='ä¸€ä¸ªæˆ–å¤šä¸ªè§†é¢‘ URL')
    parser.add_argument('-v', '--video', action='store_true',
                        help='ä¸‹è½½è§†é¢‘ï¼ˆé»˜è®¤åªä¸‹è½½éŸ³é¢‘ï¼‰')
    parser.add_argument('--no-proxy', action='store_true',
                        help='ä¸ä½¿ç”¨ä»£ç†ï¼ˆé»˜è®¤ä½¿ç”¨ä»£ç†ï¼‰')

    args = parser.parse_args()

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # æ„å»ºå¹¶æ‰§è¡Œå‘½ä»¤
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    cmd = build_command(
        args.urls,
        audio_only=not args.video,
        use_proxy=not args.no_proxy
    )

    print(f"ğŸ“¥ å‡†å¤‡ä¸‹è½½ {len(args.urls)} ä¸ªè§†é¢‘")
    print(f"ğŸ”§ æ‰§è¡Œå‘½ä»¤: {cmd}\n")
    print("â”€" * 60)

    os.system(cmd)


if __name__ == '__main__':
    main()